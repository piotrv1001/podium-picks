<div class="timer-container">
  <app-countdown-timer *ngIf="!raceFinished && timeLeft; else raceFinishedTemplate"></app-countdown-timer>
  <ng-template #raceFinishedTemplate>
    <div *ngIf="!timeLoading && raceFinished && !timeLeft">
      <span class="race-over">Race finished!</span>
      <img src="assets/img/flag.png" alt="Race flag" width="30" class="flag-img">
    </div>
  </ng-template>
</div>
<div class="row">
  <mat-tab-group class="tab-group">
    <mat-tab *ngFor="let data of dataArray" [label]="userId2Users.get(data[0])?.username ?? 'Unknown'">
      <div class="prediction-container">
        <div class="space-between">
          <div class="prediction-header">
            <span class="username">{{ userId2Users.get(data[0])?.username }}</span>
            <div *ngIf="!scoreAvailable && data[1].confirmed" class="confirm-status-container">
              <span class="saved">Saved</span>
              <mat-icon>check_circle_outline</mat-icon>
            </div>
          </div>
          <span *ngIf="scoreAvailable" class="total-points">{{ userId2Total.get(data[0]) }}</span>
        </div>
        <div class="space-between big-margin" *ngIf="data[0] === userId; else othersPredictions">
          <mat-form-field appearance="fill">
            <mat-label>Fastest lap</mat-label>
            <mat-select>
              <mat-option *ngFor="let driver of drivers" [value]="driver">{{ driver.name }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>DNF</mat-label>
            <mat-select>
              <mat-option *ngFor="let driver of drivers" [value]="driver">{{ driver.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <ng-template #othersPredictions>
          <div class="big-margin row">
            <div class="flex-col purple">
              <p>Fastest lap</p>
              <p>Max Verstappen</p>
            </div>
            <div class="flex-col gray">
              <p>DNF</p>
              <p>Yuki Tsunoda</p>
            </div>
          </div>
          <!-- <div class="space-between big-margin">
            <div>
              <p>Fastest lap</p>
              <p>DNF</p>
            </div>
            <div>
              <p>Max Verstappen</p>
              <p>Yuki Tsunoda</p>
            </div>
          </div> -->
        </ng-template>
        <app-driver-drag-drop
          [drivers]="data[1].drivers"
          [scoreArray]="userId2Scores.get(data[0])"
          [isEditable]="data[0] === userId && !raceFinished && !scoreAvailable"
          (saved)="handlePredictionSaveBtnClick($event)"
          (dropped)="handleDriverDragDrop($event)">
        </app-driver-drag-drop>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
